---
- name: Install python3-docker
  apt:
    name: python3-docker
    state: present

- name: Install pip dependancies
  pip:
    name:
      - jsondiff
      - pyyaml
      - docker-compose


- name: Create {{ item.name }} data directory {{ inventory_hostname }}
  file:
    path: "/var/lib/{{ item.name }}"
    state: directory
  loop:
    - { name: 'chronograf' }
    - { name: 'influxdb' }
    - { name: 'kapacitor' }


- name: Create {{ item.name }} conf directory {{ inventory_hostname }}
  file:
    path: "/etc/{{ item.name }}"
    state: directory
  loop:
    - { name: 'telegraf' }
    - { name: 'influxdb' }
    - { name: 'kapacitor' }

- name: "Copy {{ item.name }} to /tmp on {{ inventory_hostname }}"
  copy:
    src: "data/tick/{{ item.name }}.conf"
    dest: "/etc/{{ item.name }}/{{ item.name }}.conf"
  loop:
    - { name: 'telegraf' }
    - { name: 'influxdb' }
    - { name: 'kapacitor' }

- name: Copy docker-compose to /tmp on {{ inventory_hostname }}
  copy:
    src: data/tick/docker-compose.yml
    dest: /tmp/docker-compose.yml

- name: Deploy stack from a compose file
  community.docker.docker_stack:
    state: absent
    name: tickstack
    compose:
      - /tmp/docker-compose.yml

#- name: Deploy stack from a compose file
#  community.docker.docker_stack:
#    state: present
#    name: tickstack
#    compose:
#      - /tmp/docker-compose.yml

- name: Clone a repo with separate git directory
  ansible.builtin.git:
    repo: https://github.com/influxdata/sandbox
    dest: /tmp/sandbox

- name: do something
  shell: /bin/bash /tmp/sandox/sandbox up
