version: '3.7'
services:
  telegraf:
    image: registry.mybooking.services:5000/telegraf:v1
    configs:
    - source: telegraf-conf
      target: /etc/telegraf/telegraf.conf
    ports:
    - 8186:8186

  influxdb:
    image: registry.mybooking.services:5000/influxdb:v1
    configs:
    - source: influxdb-conf
      target: /etc/influxdb/influxdb.conf
    ports:
      # The API for InfluxDB is served on port 8086
      - "8086:8086"
      - "8082:8082"
      # UDP Port
      - "8089:8089/udp"

  chronograf:
    image: registry.mybooking.services:5000/chronograf:v1
    ports:
    - 8888:8888
    command: ["chronograf", "--influxdb-url=http://influxdb:8086"]
    depends_on:
      - kapacitor
      - influxdb
      - telegraf
    links:
      - influxdb
      - kapacitor

  kapacitor:
    image: registry.mybooking.services:5000/kapacitor:v1
    environment:
      KAPACITOR_INFLUXDB_0_URLS_0: http://influxdb:8086
      KAPACITOR_INFLUXDB_USERNAME: "etna"
      KAPACITOR_INFLUXDB_PASSWORD: "etna"
    configs:
    - source: kapacitor-conf
      target: /etc/kapacitor/kapacitor.conf
    # Kapacitor requires network access to Influxdb
    links:
      - influxdb
    ports:
      # The API for Kapacitor is served on port 9092
      - "9092:9092"

configs:
  telegraf-conf:
    file: /tmp/telegraf.conf
  influxdb-conf:
    file: /tmp/influxdb.conf
  kapacitor-conf:
    file: /tmp/kapacitor.conf
